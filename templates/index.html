{% extends "base.html" %}
{% block title %}Dateien – FileShare{% endblock %}

{% block content %}
<div class="space-y-10">
  <section class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
    <div class="space-y-2">
      <h1 class="text-3xl font-black tracking-tight text-gray-900 dark:text-white">
        Willkommen zurück, {{ current_user.username }}!
      </h1>
      <p class="text-base text-gray-600 dark:text-[#92a9c9]">
        Verwalte deine Dateien, teile sie gezielt und behalte jederzeit den Überblick.
      </p>
    </div>
    <div class="flex flex-wrap gap-3">
      <a
        class="inline-flex h-11 items-center justify-center gap-2 rounded-full bg-primary px-5 text-sm font-semibold text-white shadow-md transition hover:bg-primary/90"
        href="#upload"
      >
        <span class="material-symbols-outlined text-base">upload</span>
        Upload starten
      </a>
      <a
        class="inline-flex h-11 items-center justify-center gap-2 rounded-full border border-gray-200/60 px-5 text-sm font-semibold text-gray-700 transition hover:border-primary hover:text-primary dark:border-white/10 dark:text-white dark:hover:border-primary"
        href="/sharex-config"
      >
        ShareX Config
      </a>
    </div>
  </section>

  <section class="space-y-4" id="files">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Alle Dateien</h2>
      <button
        class="inline-flex items-center gap-2 rounded-full border border-gray-200/60 px-4 py-2 text-sm font-medium text-gray-700 transition hover:border-primary hover:text-primary dark:border-white/10 dark:text-white dark:hover:border-primary"
        id="refresh-files"
        type="button"
      >
        <span class="material-symbols-outlined text-base">refresh</span>
        Aktualisieren
      </button>
    </div>
    <div class="overflow-hidden rounded-2xl border border-gray-200/60 bg-white/80 shadow-sm dark:border-white/10 dark:bg-[#101822]/80">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200/60 dark:divide-white/10">
          <thead class="bg-gray-50/80 dark:bg-white/5">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Preview
              </th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Filename
              </th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Size
              </th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Public
              </th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Owner
              </th>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-[#92a9c9]">
                Date
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200/40 dark:divide-white/5" id="file-table-body"></tbody>
        </table>
      </div>
      <p
        class="hidden px-6 py-10 text-center text-sm text-gray-500 dark:text-[#92a9c9]"
        id="empty-state"
      >
        Noch keine Dateien vorhanden. Lade etwas hoch, um zu starten!
      </p>
    </div>
  </section>

  <section class="space-y-6" id="upload">
    <div class="rounded-2xl border border-dashed border-gray-300 bg-white/80 p-6 shadow-sm dark:border-white/10 dark:bg-[#1A1B26]/80">
      <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
        <div class="space-y-2">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Dateien hochladen</h2>
          <p class="text-sm text-gray-600 dark:text-[#92a9c9]">
            Ziehe Dateien hierher oder wähle sie aus, um den Upload zu starten. Maximal 500 MB pro Datei.
          </p>
          <label
            class="inline-flex h-10 cursor-pointer items-center justify-center gap-2 rounded-full border border-gray-200/60 bg-white px-4 text-sm font-semibold text-gray-700 transition hover:border-primary hover:text-primary dark:border-white/10 dark:bg-[#1A1B26] dark:text-white dark:hover:border-primary"
          >
            <span class="material-symbols-outlined text-base">attach_file</span>
            Dateien auswählen
            <input class="hidden" id="file-input" multiple type="file" />
          </label>
        </div>
        <div
          class="flex flex-1 flex-col items-center justify-center gap-4 rounded-2xl border-2 border-dashed border-gray-300 px-6 py-12 text-center transition hover:border-primary hover:bg-primary/5 dark:border-white/10 dark:hover:border-primary"
          id="dropzone"
        >
          <span class="material-symbols-outlined text-5xl text-gray-400">cloud_upload</span>
          <p class="text-lg font-semibold text-gray-900 dark:text-white">Dateien hierhin ziehen</p>
          <p class="text-sm text-gray-500 dark:text-[#92a9c9]">Unterstützte Formate: Bilder, Videos, Archive und mehr.</p>
          <button
            class="inline-flex h-11 items-center justify-center rounded-full bg-primary px-6 text-sm font-semibold text-white shadow-md transition hover:bg-primary/90"
            id="start-upload"
            type="button"
          >
            Upload starten
          </button>
        </div>
      </div>
    </div>
    <div class="space-y-4" id="upload-queue"></div>
  </section>

  <section class="space-y-6" id="system">
    <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
      <div class="rounded-2xl border border-gray-200/60 bg-white/80 p-6 shadow-sm dark:border-white/10 dark:bg-[#1A1B26]/80">
        <p class="text-sm font-semibold text-gray-500 dark:text-[#92a9c9]">Genutzter Speicher</p>
        <p class="mt-2 text-3xl font-bold text-gray-900 dark:text-white" id="used-storage">0 GB</p>
        <p class="text-sm text-gray-500 dark:text-[#92a9c9]">
          von <span id="total-storage">0 GB</span>
        </p>
        <div class="mt-4 h-2 w-full rounded-full bg-gray-200 dark:bg-white/10">
          <div class="h-2 rounded-full bg-primary" id="storage-progress" style="width: 0%"></div>
        </div>
        <p class="mt-2 text-right text-sm text-gray-500 dark:text-[#92a9c9]" id="storage-percent">0%</p>
      </div>
      <div class="rounded-2xl border border-gray-200/60 bg-white/80 p-6 shadow-sm dark:border-white/10 dark:bg-[#1A1B26]/80">
        <p class="text-sm font-semibold text-gray-500 dark:text-[#92a9c9]">Dateien insgesamt</p>
        <p class="mt-2 text-3xl font-bold text-gray-900 dark:text-white" id="file-count">0</p>
        <p class="text-sm text-gray-500 dark:text-[#92a9c9]">
          Einschließlich aktueller Freigaben
        </p>
      </div>
      <div class="rounded-2xl border border-gray-200/60 bg-white/80 p-6 shadow-sm dark:border-white/10 dark:bg-[#1A1B26]/80">
        <p class="text-sm font-semibold text-gray-500 dark:text-[#92a9c9]">Aktive Freigaben</p>
        <p class="mt-2 text-3xl font-bold text-gray-900 dark:text-white" id="share-count">0</p>
        <p class="text-sm text-gray-500 dark:text-[#92a9c9]">
          Öffentlich zugängliche Links
        </p>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.initialFileData = {
    files: {{ files | tojson }},
    totalSize: {{ total_size }},
    capacity: {{ capacity }},
  };
  window.currentUser = {
    id: {{ current_user.id | tojson }},
    username: {{ current_user.username | tojson }},
    is_admin: {{ current_user.is_admin | tojson }},
    copy_url_mode: {{ current_user.copy_url_mode | tojson }},
    hide_media_default: {{ current_user.hide_media_default | tojson }},
  };
  window.userPreferences = {{ preferences | tojson }};
</script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}
